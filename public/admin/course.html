<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Management</title>
    <link rel="stylesheet" href="form.css">
</head>
<body>
    <div class="container">
        <h1>Course Management</h1>

        <!-- Create Course Section -->
        <h2>Create Course</h2>
        <div class="form-group">
            <label for="courseName">Course Name</label>
            <input type="text" id="courseName" placeholder="Enter course name">
        </div>
        <div class="form-group">
            <label for="courseDescription">Course Description</label>
            <input type="text" id="courseDescription" placeholder="Enter course description">
        </div>
        <button onclick="createCourse()">Create Course</button>

        <!-- Update Course Section -->
        <h2>Update Course</h2>
        <div class="form-group">
            <label for="courseSelect">Select Course ID</label>
            <select id="courseSelect" onchange="fetchCourseDetails(this.value)">
                <option value="">Select a course</option>
            </select>
        </div>
        <div class="form-group">
            <label for="updateCourseName">Course Name</label>
            <input type="text" id="updateCourseName" placeholder="Enter course name">
        </div>
        <div class="form-group">
            <label for="updateCourseDescription">Course Description</label>
            <input type="text" id="updateCourseDescription" placeholder="Enter course description">
        </div>
        <button onclick="updateCourse()">Update Course</button>

        <!-- Course List Section -->
        <h2>Courses List</h2>
        <table>
            <thead>
                <tr>
                    <th>Course ID</th>
                    <th>Course Name</th>
                    <th>Description</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="coursesTableBody">
                <!-- Course list will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        // Function to create a new course
        function createCourse() {
            const courseName = document.getElementById('courseName').value;
            const courseDescription = document.getElementById('courseDescription').value;

            if (!courseName) {
                alert('Course Name is required');
                return;
            }

            fetch('/create-course', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ CourseName: courseName, CourseDescription: courseDescription })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Course created successfully with ID: ' + data.id);
                    loadCourses(); // Refresh the course list
                } else {
                    alert('Error creating course');
                }
            })
            .catch(err => console.error('Error creating course:', err));
        }

        // Function to update an existing course
        function updateCourse() {
            const courseID = document.getElementById('courseSelect').value;
            const courseName = document.getElementById('updateCourseName').value;
            const courseDescription = document.getElementById('updateCourseDescription').value;
            if (!courseID || !courseName) {
                alert('Course ID and Name are required');
                return;
            }

            fetch(`/update-course/${courseID}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ CourseName: courseName, CourseDescription: courseDescription })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Course updated successfully');
                    loadCourses(); // Refresh the course list
                } else {
                    alert(data.error || 'Error updating course');
                }
            })
            .catch(err => console.error('Error updating course:', err));
        }

        // Function to delete a course
        function deleteCourse(courseID) {
            fetch(`/delete-course/${courseID}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Course deleted successfully');
                    loadCourses(); // Refresh the course list
                } else {
                    alert(data.error || 'Error deleting course');
                }
            })
            .catch(err => console.error('Error deleting course:', err));
        }

        // Function to load courses into the table
        function loadCourses() {
            fetch('/getCourses')
            .then(response => response.json())
            .then(courses => {
                const coursesTableBody = document.getElementById('coursesTableBody');
                coursesTableBody.innerHTML = ''; // Clear the table

                courses.forEach(course => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${course.CourseID}</td>
                        <td>${course.CourseName}</td>
                        <td>${course.CourseDescription}</td>
                        <td><button onclick="deleteCourse(${course.CourseID})">Delete</button></td>
                    `;
                    coursesTableBody.appendChild(row);
                });

                const courseSelect = document.getElementById('courseSelect');
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.CourseID;
                    option.textContent = course.CourseName;
                    courseSelect.appendChild(option);
                });
            })
            .catch(err => console.error('Error loading courses:', err));
        }

        // Fetch course details when a course is selected
        async function fetchCourseDetails(courseID) {
            if (!courseID) {
                document.getElementById('updateCourseName').value = '';
                document.getElementById('updateCourseDescription').value = '';
                return;
            }
            const response = await fetch(`/getCourse/${courseID}`);
            const course = await response.json();
            document.getElementById('updateCourseName').value = course.CourseName;
            document.getElementById('updateCourseDescription').value = course.CourseDescription;
        }

        // Call loadCourses on page load
        document.addEventListener('DOMContentLoaded', loadCourses);
    </script>
</body>
</html>
