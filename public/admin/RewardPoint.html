<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Give Rewards/Points</title>
    <link rel="stylesheet" href="style.css">
    <script src="./RewardPoint.js"></script>
</head>
<body>
    <button class="back-button" onclick="window.location.href='index.html'">
        <i class="fa-solid fa-arrow-left"></i> 
        <span>Back</span>
    </button>
      <header class="header">
        <h1>Give Rewards
            <i class="fas fa-user" style="color: #007bff;"></i>
        </h1>
    </header>
    <div class="container">
        <h2>Give Points</h2>
        <label for="selectCourseQuiz">Quiz</label>
        <select name="selectCourseQuiz" id="selectCourseQuiz">
            <option value="">Please select a quiz</option>
        </select>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Score</th>
                    <th>Time</th>
                    <th>Add Points Action</th><!-- Default t1 300, t2 250, t3 200, t4 150, t5 100, other (Score >= 50) 50 -->
                </tr>
            </thead>
        </table>

        <h2>Reward Requirements</h2>
        <table id="UsersRewards">
            <thead>
                <tr>
                    <th>UserID</th><!-- 改为name -->
                    <th>Time</th>
                    <th>Reward</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
        </table>

        <h2>Point Rank</h2>
        <table id="UsersPoint">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Points</th>
                </tr>
            </thead>
        </table>
    </div>
    <script>
        function getUsersPoint() {
            fetch('/api/getUsersPoint')
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById('UsersPoint');
                data.forEach((user, index) => {
                    const row = table.insertRow();
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${user.Name}</td>
                        <td>${user.RewardPoint}</td>
                    `;
                });
            });
        }

        function getUsersRewards() {
            fetch('/api/getUsersRewards')
            .then(response => response.json())
            .then(data => {
                const table = document.getElementById('UsersRewards');
                data.forEach(reward => {
                    const row = table.insertRow();
                    row.innerHTML = `
                        <td>${reward.UserID}</td>
                        <td>${reward.RewardTime}</td>
                        <td>${reward.RewardID}</td>
                        <td>${reward.Status === 2 ? 'Completed' : 'In Progress'}</td>
                        <td>
                            <button onclick="markCompleted(${reward.RewardID})" ${reward.Status === 2 ? 'disabled' : ''}>Completed</button>
                        </td>
                    `;
                });
            });
        }

        function markCompleted(rewardID) {
            fetch(`/api/markUserRewardCompleated/${rewardID}`, {
                method: 'POST'
            })
            .then(() => {
                getUsersRewards();
                getUsersPoint();
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            getUsersPoint();
            getUsersRewards();
        });
    </script>
</body>
</html>